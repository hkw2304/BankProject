<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Insert title here</title>
<link rel="stylesheet" href="style/register/makeAccount.css">
</head>
<body>
<th:block th:replace="layouts/header :: headerFragment"></th:block>
	<h1 class="title">조회</h1>
		<div class="select__total">
		<select id="account_select">
			<option value="none" disabled selected> === 선택 === </option>
			<option class="account_option" th:each="list : ${accountNum}" th:text="${list}"></option>
		</select>
		<br>
		<span class="total"></span>
		</div>
		<table class = "accountList_table">
			<tr>
				<th>입금 / 출금</th>
				<th>거래금액</th>
				<th>거래내역</th>
			</tr>
		</table>
		<div class="accountList">
		<br>
		</div>
		<th:block th:replace="layouts/footer :: footerFragment"></th:block>
		
	<script th:inline="javascript">
		//var userVal = document.getElementById("mySelect1").selectedIndex;
		
		const accountTotal = [[${accountTotal}]];
		
		const plusList = [[${plusList}]];
		const remitList = [[${remitList}]];
		console.log(plusList, remitList)
		
		let totalList = plusList.concat(remitList);
		console.log('정렬전 >>> ',totalList);
		let totalSorted = totalList.sort((a, b) => {
			return new Date(a.exchage_date) - new Date(b.exchage_date)
		});
		
		console.log(totalSorted);
		
		const accountList = document.querySelector(".accountList");
		const account_select = document.querySelector("#account_select");
		const total = document.querySelector(".total");
		const accountList_table = document.querySelector(".accountList_table");
		
		const funcSelectOption = () => {
			let newPTagMoney;
			let newPTagDate;
			let newPTagSign;
			let selectIndex = account_select.selectedIndex;
			total.innerText = `총 잔액 : ${accountTotal[selectIndex - 1]}원`;
			if(document.querySelectorAll(".newptag").length !== 0){

				accountList.replaceChildren();
			}
			for(let i = 0; i < totalSorted.length; i++){
				if(totalSorted[i].account_num === account_select.value){
					newtrTag = document.createElement('tr');
					if(totalSorted[i].exchange_sign === '+'){
						newtdTag = document.createElement('td');
						newtdTag.innerText = '입금';
					}
					else{
						newtdTag = document.createElement('td');
						newtdTag.innerText = '출금';
					}
					newPTagMoney = document.createElement('p');
					newPTagDate = document.createElement('p');
					
					
					newPTagMoney.innerText = totalSorted[i].exchange_money;
					newPTagDate.innerText = totalSorted[i].exchage_date;
					accountList.appendChild(newPTagSign);
					accountList.appendChild(newPTagDate);
					accountList.appendChild(newPTagMoney);	
					accountList.appendChild(newhr);	
				}
			}
		}
		account_select.addEventListener("change", funcSelectOption);
	</script>
</body>
</html>