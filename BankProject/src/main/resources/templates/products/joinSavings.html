<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Insert title here</title>
</head>
<body>
	<form action="joinComplete" method="post">
		<input type="hidden" name="product_num" th:value="${savings.product_num}">
		상품명: <input th:value= " ${savings.deposit_name}" readonly> <br>
		가입 기간: <input th:value=" ${savings.create_date} " readonly> <br>
		<select name="account_num" id="account_num" >
			<option value="" selected disabled>계좌 선택</option>
			<option th:each="account : ${account}"
					th:value="${account}"
					th:utext="${account}"></option>
		</select>
		<br>
		<span class="totalMoney"></span>
		<br>	
		가입 금액: <input name="total" type="text" id="savings_money" th:placeholder="'가입 최소금액은 '+${savings.min_money}+'원 입니다.'"> <br>
		이율: <input th:value=" ${savings.rate} " readonly> <br>
		<input type="submit" value="가입하기" onclick="return func()">
	</form>
	
	<script th:inline="javascript">
	
		const select_account = document.querySelector("#account_num");
		
		const savings_money=document.querySelector("#savings_money");
		const totalText = document.querySelector(".totalMoney");
		const account2 = [[${account}]]
		const total = [[${total}]]
		
	
		let accountnum = '';
		let ck = false;
		let totalMoney;
		
		const func=() => {
			ck = false;
			let money;		
			for(let i=0; i<account2.length; i++) {
				console.log(account_num.value)
				if(account2[i]===account_num.value) {
					money = total[i]
				}
			}if(money < savings_money.value) {
				alert("잔액이 부족합니다. 다른 계좌를 선택하세요")
				return ck;
			} else {
				alert("가입되었습니다!")
				ck = true;
			}
		}
		
		const funcChange = () =>{
			let selectIndex = select_account.selectedIndex;
			totalMoney = total[selectIndex - 1];
			totalText.innerText = `총 잔액 : ${total[selectIndex - 1]}원`;
		}
		
		select_account.addEventListener('change', funcChange);
	</script>
</body>
</html>