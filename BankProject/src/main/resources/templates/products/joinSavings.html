<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Insert title here</title>
<link rel="stylesheet" href="style/register/makeAccount.css">
<link rel="stylesheet" href="style/admin/admin.css">
</head>
<body>
<!-- 


 -->
<th:block th:replace="~{layouts/header :: headerFragment}"></th:block>
	<h1>적금 상품 페이지</h1>
		<div class="product__items" style="height: 700px; position:relative; bottom: 50px;">
		<div class="product__name product__common" style="width: 380px;">
			<span>계좌선택 : </span>
		<select name="account_num" id="account_num" >
			<option value="" selected disabled>계좌 선택</option>
			<option th:each="account : ${account}"
					th:value="${account}"
					th:utext="${account}"></option>
		</select>
		<span class="totalMoney"></span>
		</div>
		<div class="product__name product__common" style="width: 380px;">
			<span>가입대상 : </span>
			<span>개인</span>
		</div>
		<div class="product__name product__common" style="width: 380px;">
			<span>상품 이름 : </span>
			<span th:text="${savings.deposit_name}" ></span>
		</div>
		<div class="product__date product__common" style="width: 380px;">
			<span>기간 : </span>
			<span th:text="${savings.create_date} + '년'" ></span>
		</div>
		<div class="product__date product__common" style="width: 380px;">
			<span>최소금액 : </span>
			<span th:text="${savings.min_money} + '원'" ></span>
		</div>
		<div class="product_rate product__common" style="width: 380px;">
			<span>비율 : </span>
			<span th:text="${savings.rate} + '%'"></span>
		</div>
		<div class="product_rate product__common" style="width: 380px;">
		<form action="depositController" method="post">
			<input name="product_num" th:value="${savings.product_num}" type="hidden">
			<input type="hidden" name="id" th:value="${session.login.id}">
			<span>가입금액 : </span>
			<input type="text" name = "total" id="savings_money" class="myMoney" th:placeholder="'최소 가입금액 '+${savings.min_money}+'원'" >
			<button type="submit" onclick="return func()" class="depositBtn submit">가입하기</button>
		</form>
		</div>
	</div>
	<th:block th:replace="~{layouts/footer :: footerFragment}"></th:block>
	<script th:inline="javascript">
	
		const select_account = document.querySelector("#account_num");
		const savings_money=document.querySelector("#savings_money");
		const totalText = document.querySelector(".totalMoney");
		const account2 = [[${account}]]
		const total = [[${total}]]
		const accountPW = [[${accountPW}]];
		
	
		let accountnum = '';
		let ck = false;
		let totalMoney;
		let pwCk;
		
		const func=() => {
			ck = false;
			let money;
			let account_pw = Number(prompt("계좌 비밀번호 입력"));
			
			for(let i=0; i<account2.length; i++) {
				console.log(account_num.value)
				if(account2[i]===account_num.value) {
					money = total[i]
				}
			}if(Number(money) > Number(totalMoney)) {
				alert("잔액이 부족합니다. 다른 계좌를 선택하세요")
			}else if(pwCk != account_pw){
				alert("계좌 비밀번호가 다릅니다.")
			}
			else {
				alert("가입되었습니다!")
				ck = true;
			}
			return ck
		}
		
		const funcChange = () =>{
			let selectIndex = select_account.selectedIndex;
			totalMoney = total[selectIndex - 1];
			pwCk = accountPW[selectIndex - 1];
			totalText.innerText = `총 잔액 : ${total[selectIndex - 1]}원`;
		}
		
		select_account.addEventListener('change', funcChange);
	</script>
</body>
</html>